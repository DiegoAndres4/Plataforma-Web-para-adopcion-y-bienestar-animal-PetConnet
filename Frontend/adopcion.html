<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PetConnect - Adopci√≥n</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Tus estilos -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/adopcion.css">

  <style>
    /* Estilos adicionales para loading y mensajes */
    .loading-container {
      text-align: center;
      padding: 3rem;
    }

    .loading-spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #ff6b6b;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-message {
      background: #ffebee;
      color: #c62828;
      padding: 1.5rem;
      border-radius: 8px;
      text-align: center;
      margin: 2rem 0;
    }

    .empty-message {
      text-align: center;
      padding: 3rem;
      color: #666;
    }

    .empty-message i {
      font-size: 4rem;
      color: #ccc;
      margin-bottom: 1rem;
    }

    /* Ocultar elementos que no se usan */
    .adopcion-search,
    .adopcion-filters {
      display: none;
    }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg site-navbar bg-white">
    <div class="container">
      <a class="navbar-brand logo" href="index.html">
        <img src="img/logo.png" alt="PetConnect">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center">
          <li class="nav-item"><a class="nav-link" href="adopcion.html">Adopci√≥n</a></li>
          <li class="nav-item"><a class="nav-link" href="denuncias.html">Denuncias</a></li>
          <li class="nav-item"><a class="nav-link" href="acerca.html">Acerca de</a></li>
          <li class="nav-item"><a class="nav-link" href="Contactenos.html">Contacto</a></li>
          <li class="nav-item"><a class="nav-link btn login-btn text-white ms-lg-3" href="login.html" id="loginBtn">Login</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="adopcion-container">

    <div class="adopcion-header">
      <h1>Encuentra a tu nuevo mejor amigo</h1>
      <p>En PetConnect, creemos que cada mascota merece un hogar amoroso. Explora nuestras mascotas disponibles.</p>
    </div>

    <!-- BOT√ìN PUBLICAR -->
    <div class="adopcion-actions">
      <a href="publicarmascota.html" class="btn-publicar" id="btnPublicar">+ Publicar Mascota en Adopci√≥n</a>
    </div>

    <!-- BUSCADOR (Oculto) -->
    <div class="adopcion-search">
      <input id="search" type="text" class="search-input" placeholder="üîç Busca por nombre, raza o ubicaci√≥n">
    </div>

    <!-- FILTROS (Ocultos) -->
    <div class="adopcion-filters">
      <button class="filter-btn">Edad</button>
      <button class="filter-btn">Tama√±o</button>
      <button class="filter-btn">Ubicaci√≥n</button>
      <button class="filter-btn">Especie</button>
    </div>

    <!-- LOADING -->
    <div class="loading-container" id="loadingContainer">
      <div class="loading-spinner"></div>
      <p style="margin-top: 1rem; color: #666;">Cargando mascotas...</p>
    </div>

    <!-- MENSAJE DE ERROR -->
    <div class="error-message" id="errorMessage" style="display: none;"></div>

    <!-- GRID DIN√ÅMICO -->
    <div class="adopcion-grid" id="mascotas-container"></div>

    <!-- PAGINACI√ìN DIN√ÅMICA (No se usa sin filtros) -->
    <div class="adopcion-pagination" id="pagination" style="display: none;"></div>

  </div>

  <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 PetConnect. Todos los derechos reservados.</p>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- SCRIPT DIN√ÅMICO -->
  <script>
    console.log("üöÄ P√°gina de adopci√≥n cargada");

    // Verificar si est√° logueado
    function verificarLogin() {
      const isLoggedIn = localStorage.getItem("isLoggedIn");
      const userName = localStorage.getItem("userName");
      
      if (isLoggedIn === "true" && userName) {
        console.log("‚úÖ Usuario logueado:", userName);
        document.getElementById("loginBtn").textContent = userName;
        document.getElementById("loginBtn").href = "dashboard.html";
      } else {
        console.log("‚ÑπÔ∏è Usuario no logueado");
      }
    }

    // Cargar TODAS las mascotas desde API (sin filtros, sin paginaci√≥n)
    async function cargarMascotas() {
      console.log("üì§ Solicitando todas las mascotas...");
      
      const loadingContainer = document.getElementById("loadingContainer");
      const errorMessage = document.getElementById("errorMessage");
      const contenedor = document.getElementById("mascotas-container");

      // Mostrar loading
      loadingContainer.style.display = "block";
      errorMessage.style.display = "none";
      contenedor.innerHTML = "";

      try {
        const url = `http://localhost:8081/api/adopciones/todas`;
        console.log("üåê URL:", url);

        const response = await fetch(url);
        console.log("üì• Respuesta:", response.status, response.statusText);

        if (!response.ok) {
          throw new Error(`Error del servidor: ${response.status}`);
        }

        const mascotas = await response.json();
        console.log("‚úÖ Mascotas recibidas:", mascotas.length);
        console.log("üìã Datos:", mascotas);

        // Ocultar loading
        loadingContainer.style.display = "none";

        // Mostrar mascotas
        if (mascotas.length === 0) {
          mostrarMensajeVacio();
        } else {
          mostrarMascotas(mascotas);
        }

      } catch (error) {
        console.error("üí• Error al cargar mascotas:", error);
        loadingContainer.style.display = "none";
        
        errorMessage.textContent = `Error al cargar las mascotas: ${error.message}. Verifica que el servidor est√© corriendo en http://localhost:8081`;
        errorMessage.style.display = "block";
      }
    }

    // Mostrar tarjetas de mascotas
    function mostrarMascotas(lista) {
      const contenedor = document.getElementById("mascotas-container");
      contenedor.innerHTML = "";

      console.log(`üé® Mostrando ${lista.length} mascotas`);

      lista.forEach((m, index) => {
        console.log(`üêæ Mascota ${index + 1}:`, m.nombre, m.urlImagen);

        const card = document.createElement('div');
        card.className = 'pet-card';
        card.innerHTML = `
          <img src="${m.fotoUrl}" 
               alt="${m.nombre}"
               onerror="this.src='https://via.placeholder.com/300x250?text=Sin+Imagen'">
          <div class="pet-info">
            <h5>${m.nombre}</h5>
            <p>
              ${m.descripcion ? m.descripcion.substring(0, 100) + (m.descripcion.length > 100 ? '...' : '') : 'Sin descripci√≥n'}
              <br>
              <strong>${m.especie || 'N/A'} ‚Ä¢ ${m.genero || 'N/A'} ‚Ä¢ ${m.edadCategoria || 'N/A'}</strong>
            </p>
            <a href="adoptar.html?id=${m.id}" class="btn-adoptar">Conocer m√°s</a>
          </div>
        `;
        
        contenedor.appendChild(card);
      });
    }

    // Mostrar mensaje cuando no hay mascotas
    function mostrarMensajeVacio() {
      const contenedor = document.getElementById("mascotas-container");
      contenedor.innerHTML = `
        <div class="empty-message" style="grid-column: 1 / -1;">
          <i>üêæ</i>
          <h3>A√∫n no hay mascotas disponibles</h3>
          <p>S√© el primero en publicar una mascota en adopci√≥n</p>
          <a href="publicarmascota.html" class="btn-publicar" style="margin-top: 1rem; display: inline-block;">
            + Publicar Mascota
          </a>
        </div>
      `;
    }

    // Actualizar bot√≥n de publicar seg√∫n estado de login
    function actualizarBotonPublicar() {
      const btnPublicar = document.getElementById("btnPublicar");
      const isLoggedIn = localStorage.getItem("isLoggedIn");
      
      if (isLoggedIn === "true") {
        btnPublicar.href = "publicarmascota.html";
      } else {
        btnPublicar.href = "login.html";
      }
    }

    // Inicializar al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', () => {
      console.log("üìÑ DOM cargado, inicializando...");
      verificarLogin();
      actualizarBotonPublicar();
      cargarMascotas();
    });

    // Recargar al hacer foco en la ventana (por si publican algo)
    window.addEventListener('focus', () => {
      console.log("üëÅÔ∏è Ventana enfocada, recargando mascotas...");
      cargarMascotas();
    });
  </script>

</body>
</html>